{% extends "base.html" %}
{% block title %}{{ dish.name }}{% endblock %}
{% block content %}

<style>

.recipe-container { max-width: 900px; margin: 40px auto; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
.recipe-header { display: flex; flex-wrap: wrap; background: #faf7f2; }
.recipe-image { width: 45%; min-width: 300px; object-fit: cover; min-height: 400px; }
.recipe-header-info { padding: 40px; flex: 1; min-width: 300px; display: flex; flex-direction: column; justify-content: center; }
.recipe-stats { display: flex; gap: 15px; margin: 20px 0; }
.stat-item { background: white; padding: 10px; border-radius: 10px; text-align: center; flex: 1; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
.stat-value { display: block; font-weight: bold; color: #b8a080; font-size: 18px; }
.stat-label { font-size: 12px; color: #888; text-transform: uppercase; }
.recipe-body { padding: 40px; display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; }

@media (max-width: 768px) {
    .recipe-body { grid-template-columns: 1fr; }
    .recipe-image { width: 100%; }
}

.ingredients-list { list-style: none; padding: 0; }
.ingredients-list li { padding: 10px 0; border-bottom: 1px solid #eee; }
.steps-list { padding-left: 20px; }
.steps-list li { margin-bottom: 15px; line-height: 1.6; }
.btn-review { display: inline-block; background: #b8a080; color: white; padding: 12px 25px; border-radius: 25px; text-decoration: none; font-weight: bold; margin-top: 20px; text-align: center; transition: 0.3s; }
.btn-review:hover { background: #a38b6d; }

.reviews-section { padding: 40px; background: #fff; border-top: 1px solid #f0f0f0; }
.reviews-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
.sort-box { display: flex; gap: 10px; }
.sort-link { font-size: 13px; text-decoration: none; color: #888; padding: 6px 14px; border-radius: 20px; background: #f5f5f5; transition: 0.3s; }
.sort-link.active { background: #b8a080; color: white; }

.reviews-carousel {
    display: flex;
    gap: 20px;
    overflow-x: auto;
    padding-bottom: 20px;
    scroll-snap-type: x mandatory;
    scrollbar-width: thin;
}
.reviews-carousel::-webkit-scrollbar { height: 6px; }
.reviews-carousel::-webkit-scrollbar-thumb { background: #e0e0e0; border-radius: 10px; }

.review-card {
    flex: 0 0 300px;
    scroll-snap-align: start;
    background: #faf7f2;
    padding: 20px;
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    position: relative;
}

.review-header-wrapper { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
.delete-btn { background: none; border: none; color: #cc7a7a; cursor: pointer; font-size: 18px; padding: 0; line-height: 1; transition: 0.2s; }
.delete-btn:hover { color: #ff0000; transform: scale(1.2); }

.review-user { display: flex; align-items: center; gap: 10px; }
.rev-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
.rev-avatar-placeholder { width: 35px; height: 35px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 18px; }
.rev-info { display: flex; flex-direction: column; }
.rev-name { font-weight: bold; font-size: 14px; }
.rev-date { font-size: 11px; color: #aaa; }
.rev-rating { color: #ffc107; margin-bottom: 10px; font-size: 14px; }
.rev-text { font-size: 14px; color: #555; line-height: 1.4; margin: 0; }
</style>

<div class="recipe-container">
    <div class="recipe-header">
        <img src="{{ url_for('static', path='images/' + dish.image) }}" alt="{{ dish.name }}" class="recipe-image">
        <div class="recipe-header-info">
            <h1>{{ dish.name }}</h1>
            <div class="recipe-stats">
                <div class="stat-item"><span class="stat-value">{{ dish.cooking_time }}</span><span class="stat-label">—Ö–≤</span></div>
                <div class="stat-item"><span class="stat-value">{{ dish.calories }}</span><span class="stat-label">–∫–∫–∞–ª</span></div>
                <div class="stat-item"><span class="stat-value">{{ dish.servings }}</span><span class="stat-label">–ø–æ—Ä—Ü—ñ—ó</span></div>
            </div>
            <h3>
                {% if dish.rating > 0 %}
                    ‚≠ê {{ dish.rating }} / 10
                {% else %}
                    –û—Ü—ñ–Ω–æ–∫ —â–µ –Ω–µ–º–∞—î
                {% endif %}
            </h3>
            <a href="/recipe/{{ dish.id }}/review" class="btn-review">–ó–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫</a>
        </div>
    </div>

    <div class="recipe-body">
        <div>
            <h3>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏</h3>
            <ul class="ingredients-list">
                {% for item in ingredients %}
                    {% if item.strip() %}<li>{{ item.strip() }}</li>{% endif %}
                {% endfor %}
            </ul>
        </div>
        <div>
            <h3>–ö—Ä–æ–∫–∏ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è</h3>
            <ol class="steps-list">
                {% for step in steps %}
                    {% if step.strip() %}<li>{{ step.strip() }}</li>{% endif %}
                {% endfor %}
            </ol>
        </div>
    </div>

    <div class="reviews-section">
        <div class="reviews-header">
            <h2>–í—ñ–¥–≥—É–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>
            <div class="sort-box">
                <a href="?sort=newest" class="sort-link {% if current_sort == 'newest' %}active{% endif %}">–ù–æ–≤—ñ</a>
                <a href="?sort=highest" class="sort-link {% if current_sort == 'highest' %}active{% endif %}">–ù–∞–π–∫—Ä–∞—â—ñ</a>
                <a href="?sort=lowest" class="sort-link {% if current_sort == 'lowest' %}active{% endif %}">–ù–∞–π–≥—ñ—Ä—à—ñ</a>
            </div>
        </div>

        <div class="reviews-carousel">
            {% for review in reviews %}
                <div class="review-card">
                    <div class="review-header-wrapper">
                        <div class="review-user">
                            {% if review.author.avatar %}
                                <img src="{{ url_for('static', path=review.author.avatar) }}" class="rev-avatar">
                            {% else %}
                                <div class="rev-avatar-placeholder">üë§</div>
                            {% endif %}
                            <div class="rev-info">
                                <span class="rev-name">{{ review.author.username }}</span>
                                <span class="rev-date">{{ review.created_at.strftime('%d.%m.%Y') }}</span>
                            </div>
                        </div>

                        {# –ö–ù–û–ü–ö–ê –í–ò–î–ê–õ–ï–ù–ù–Ø #}
                        {% if user and user.id == review.user_id %}
                        <form action="/review/delete/{{ review.id }}" method="post" onsubmit="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≤–∞—à –≤—ñ–¥–≥—É–∫?');">
                            <button type="submit" class="delete-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏">√ó</button>
                        </form>
                        {% endif %}
                    </div>

                    <div class="rev-rating">
                        {% for i in range(1, 11) %}
                            {% if i <= review.rating %}‚òÖ{% else %}‚òÜ{% endif %}
                        {% endfor %}
                    </div>
                    {% if review.text %}
                        <p class="rev-text">{{ review.text }}</p>
                    {% else %}
                        <p class="rev-text" style="font-style: italic; color: #999;">–ë–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–º–µ–Ω—Ç–∞—Ä—è</p>
                    {% endif %}
                </div>
            {% else %}
                <p style="color: #888;">–í—ñ–¥–≥—É–∫—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î. –ë—É–¥—å—Ç–µ –ø–µ—Ä—à–∏–º!</p>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}
