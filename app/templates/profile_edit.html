{% extends "base.html" %}
{% block title %}Редагувати профіль{% endblock %}
{% block content %}
<style>
.edit-profile-box { max-width: 420px; margin: 60px auto; background: #f5ede0; border-radius: var(--border-radius-main, 20px); padding: 40px; text-align: center; }
.avatar-wrapper { display: flex; justify-content: center; margin-bottom: 20px; }
.avatar-circle { width: 90px; height: 90px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; cursor: pointer; }
.avatar-circle svg { width: 54px; height: 54px; color: #333; }
.avatar-circle img { width: 100%; height: 100%; object-fit: cover; display: none; }
.avatar-upload-input { display: none; }
.avatar-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.18); border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.2s; }
.avatar-circle:hover .avatar-overlay { opacity: 1; }
.avatar-overlay svg { width: 24px; height: 24px; color: white; }
.edit-profile-box h1 { font-size: 24px; font-weight: 700; color: #2a1f14; margin-bottom: 28px; line-height: 1.3; }
.edit-profile-box h2 { font-size: 15px; font-weight: 700; color: #2a1f14; text-align: left; margin-bottom: 12px; margin-top: 0; }
.edit-profile-box input[type="text"],
.edit-profile-box input[type="email"] { width: 100%; padding: 10px 14px; margin-bottom: 14px; border: 1px solid #d9c9b5; border-radius: 8px; font-size: 15px; background: white; box-sizing: border-box; color: #2a1f14; }
.edit-profile-box input[type="text"]:focus,
.edit-profile-box input[type="email"]:focus { outline: none; border-color: #b8a080; }
.goals-section { text-align: left; margin-bottom: 24px; }
.checkbox-label { display: flex; align-items: center; gap: 10px; font-size: 15px; color: #2a1f14; margin-bottom: 10px; cursor: pointer; }
.checkbox-label input[type="checkbox"] { width: 18px; height: 18px; accent-color: #4a90d9; cursor: pointer; flex-shrink: 0; }
.divider { border: none; border-top: 1px solid #ddd0bc; margin: 22px 0; }
.btn-save { width: 100%; padding: 11px; background: #b8a080; color: white; border: none; border-radius: 8px; font-size: 15px; cursor: pointer; font-weight: 600; }
.btn-save:hover { background: #a08060; }
.edit-profile-box .success { color: green; margin-bottom: 14px; font-size: 14px; }
.edit-profile-box .error { color: red; margin-bottom: 14px; font-size: 14px; }
</style>
<div class="edit-profile-box">
    <div class="avatar-wrapper">
        <label class="avatar-circle" title="Завантажити фото">
            <input type="file" class="avatar-upload-input" accept="image/*" id="avatarInput">
            <img id="avatarPreview" src="" alt="Аватар">
            <svg id="avatarIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <path stroke-linecap="round" d="M4 20c0-4 3.6-7 8-7s8 3 8 7" fill="none"/>
            </svg>
            <div class="avatar-overlay">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5V19a1 1 0 001 1h3M21 16.5V19a1 1 0 01-1 1h-3M3 7.5V5a1 1 0 011-1h3M21 7.5V5a1 1 0 00-1-1h-3M12 8v8M8 12l4-4 4 4"/>
                </svg>
            </div>
        </label>
    </div>
    <h1>Відредагуйте<br>профіль</h1>
    {% if message %}
        <p class="success">{{ message }}</p>
    {% endif %}
    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}
    <form method="post" action="/profile/edit" enctype="multipart/form-data">
        <h2>Особисті дані</h2>
        <input type="text" name="username" placeholder="Ім'я користувача" value="{{ user.username }}">
        <input type="email" name="email" placeholder="Email" value="{{ user.email }}">
        <hr class="divider">
        <div class="goals-section">
            <h2>Мета харчування</h2>
            <label class="checkbox-label">
                <input type="checkbox" name="goals" value="схуднення"
                    {% if 'схуднення' in user.goals %}checked{% endif %}>
                схуднення
            </label>
            <label class="checkbox-label">
                <input type="checkbox" name="goals" value="набір маси"
                    {% if 'набір маси' in user.goals %}checked{% endif %}>
                набір маси
            </label>
            <label class="checkbox-label">
                <input type="checkbox" name="goals" value="підтримка ваги"
                    {% if 'підтримка ваги' in user.goals %}checked{% endif %}>
                підтримка ваги
            </label>
            <label class="checkbox-label">
                <input type="checkbox" name="goals" value="здорове харчування"
                    {% if 'здорове харчування' in user.goals %}checked{% endif %}>
                здорове харчування
            </label>
        </div>
        <button type="submit" class="btn-save">Зберегти зміни</button>
    </form>
</div>
<script>
    const input = document.getElementById('avatarInput');
    const preview = document.getElementById('avatarPreview');
    const icon = document.getElementById('avatarIcon');
    input.addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => {
                preview.src = e.target.result;
                preview.style.display = 'block';
                icon.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}
